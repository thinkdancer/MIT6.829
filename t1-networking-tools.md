# Networking Tools

## Overview

在这个指导手册中，我们会覆盖网络研究中经常使用的工具（更不用说在现实世界中调试使用了）。我们从netstat和tcpdump开始，通过查看一个活跃的TCP连接，并熟悉它们的输出结果，以此来简要介绍如何使用它们中的每一个。我们将会使用netstat来描述TCP状态机的每一个元素。

接下来，我们会学习一组基于查找的工具，dig和whois,它们提供了主机的DNS信息，并分别提供关于名字和网络的注册信息。

然后，我们会转换到标准网络测量工具，ping以及更加有趣的traceroute,并描述它们如何工作，以及它们能（不能）告诉你什么。

最后，对于你们中不知道perl的人，我将展示如何“将事情黏连起来”。具体方法是展示一个简单的perl脚本，他读取我们的trace结果，并计算到目的IP地址和AS网络号的字节数。

## 1. tcpdump and netstat

tcpdump是如何工作的？对于BSD演变的内核来说，伯克利包过滤器(BPF)是支持的。这个过滤器将设备驱动程序设置为混杂模式，从驱动接收模块接收所有发送和接收的报文。这些报文然后通过一个用户指定的过滤器，以便只有用户指定的感兴趣的报文才被送到用户进程中。通过常量方式实现内核对于小包读取的具体开销是多少，对于批量读取需要设置超时时间。

过滤器工作在内核中。这会限制从内核拷贝到用户态中的数据数量。

下面是在我的电脑上的一些输出结果，对应的命令是：tcpdump host -i eth0 aros.ron.lcs.mit.edu port ssh 

时间戳选项的具体含义是？比如，为什么不使用包发送的时间标记一个报文？(需要时钟同步)

每一行包含的信息有：时间戳，源和目的地址（地址和端口号），TCP flags, 段信息（开始，结束，大小），acks, 窗口大小，各种TCP的其他选项。其中“P”标记表示尽可能快的“push”接收的数据到应用程序。注意其中的三次握手。另外，注意断开连接的过程。

简要描述一下状态转换图，使用“rule set”的汇总信息，来介绍TCP是如何工作的。

为什么连接进入了time wait状态？注意这里还有名为“2MSL”(最大段生存时间)的状态。结束动作中执行主动关闭（active close）时不知道最后的ACK已经被接收了，所以它也不知道另一端关闭了当前的连接。仅仅因为FIN报文到达，我们不能断定连接已经被关闭了————因为报文可能乱序到达。

你能想到各种不同的TCP攻击么？Sequence number攻击是其中一种。SYN flood攻击是另外一种？你是如何防御SYN flood攻击的？一种方法是叫做“SYN Cookies”的方法，这是指发送方不会建立连接，直到当三次握手完成后（相对于进入当接收第一个SYN报文后进入的SYN接收状态）。在接下来的周课件中会讨论这个主题。

## 2. Lookup Tools: dig and whois

dig是一种DNS查询工具。他和nslookup很类似，但是功能更加强大。你可以查询各种类型的记录。其中最普遍（默认）的是“A”记录，这种一种记录DNS名字到IP地址的映射。

这是在我的机器上查询的一些样例输出。注意查询是针对“A”记录的。dig还可以返回一系列其他有用的信息。比如，它返回了对于lcs.mit.edu的“NS”记录。NS记录返回对于特定域名经过认证的DNS服务器。注意我还获得对于所有其他机器的“A”记录。为什么对于每个域都以点号结束。因为这可以告诉你名字是被完全授权的（试着在MIT的机器上分别查询ai和ai.）。

其中的数字“1800”描述了本地的DNS服务器应该缓存这个查询结果的时长。

当名字无法被解析的时候解释输出是什么样子。解释反向DNS查询，部分授权的域名等等。

## 3. Measurement Tools : ping and traceroute


## 4. Perl



